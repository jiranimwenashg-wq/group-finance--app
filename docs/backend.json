{
  "entities": {
    "Group": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Group",
      "type": "object",
      "description": "Represents a community group using the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the group entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the group."
        },
        "currency": {
          "type": "string",
          "description": "The currency used by the group (e.g., KES, USD)."
        },
        "description": {
          "type": "string",
          "description": "A description of the group."
        }
      },
      "required": [
        "id",
        "name",
        "currency"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "groupId": {
          "type": "string",
          "description": "Reference to the Group this user belongs to. (Relationship: Group 1:N User)"
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Full name of the user."
        }
      },
      "required": [
        "id",
        "groupId",
        "email",
        "name"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction entity."
        },
        "groupId": {
          "type": "string",
          "description": "Reference to the Group this transaction belongs to. (Relationship: Group 1:N Transaction)"
        },
        "memberId": {
          "type": "string",
          "description": "Reference to the Member associated with this transaction. (Relationship: Member 1:N Transaction)"
        },
        "date": {
          "type": "string",
          "description": "Date of the transaction.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the transaction."
        },
        "description": {
          "type": "string",
          "description": "Description of the transaction."
        },
        "category": {
          "type": "string",
          "description": "Category of the transaction (e.g., income, expense)."
        }
      },
      "required": [
        "id",
        "groupId",
        "memberId",
        "date",
        "amount",
        "description",
        "category"
      ]
    },
    "Member": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Member",
      "type": "object",
      "description": "Represents a member of the community group.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the member entity."
        },
        "groupId": {
          "type": "string",
          "description": "Reference to the Group this member belongs to. (Relationship: Group 1:N Member)"
        },
        "name": {
          "type": "string",
          "description": "Name of the member."
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the member."
        },
        "joinDate": {
          "type": "string",
          "description": "The date the member joined the group.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the member.",
          "enum": [
            "Active",
            "Inactive"
          ]
        }
      },
      "required": [
        "id",
        "groupId",
        "name",
        "joinDate",
        "status"
      ]
    },
    "InsurancePolicy": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InsurancePolicy",
      "type": "object",
      "description": "Represents an insurance policy.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the insurance policy entity."
        },
        "groupId": {
          "type": "string",
          "description": "Reference to the Group this policy belongs to. (Relationship: Group 1:N InsurancePolicy)"
        },
        "name": {
          "type": "string",
          "description": "Name of the insurance policy."
        },
        "premiumAmount": {
          "type": "number",
          "description": "Monthly premium amount for the policy."
        }
      },
      "required": [
        "id",
        "groupId",
        "name",
        "premiumAmount"
      ]
    },
    "InsurancePayment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InsurancePayment",
      "type": "object",
      "description": "Represents a member's payment towards an insurance policy.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the insurance payment entity."
        },
        "memberId": {
          "type": "string",
          "description": "Reference to the Member making the payment. (Relationship: Member 1:N InsurancePayment)"
        },
        "policyId": {
          "type": "string",
          "description": "Reference to the InsurancePolicy being paid for."
        },
        "payments": {
          "type": "object",
          "description": "A map of monthly payment statuses (e.g., '2023-01': 'Paid').",
          "additionalProperties": {
            "type": "string",
            "enum": [
              "Paid",
              "Unpaid",
              "Waived"
            ]
          }
        },
        "groupId": {
          "type": "string",
          "description": "Reference to the Group this payment belongs to."
        }
      },
      "required": [
        "id",
        "memberId",
        "policyId",
        "payments",
        "groupId"
      ]
    },
    "Constitution": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Constitution",
      "type": "object",
      "description": "Represents the group's constitution document.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the constitution entity."
        },
        "groupId": {
          "type": "string",
          "description": "Reference to the Group this constitution belongs to. (Relationship: Group 1:N Constitution)"
        },
        "content": {
          "type": "string",
          "description": "The text content of the constitution document."
        }
      },
      "required": [
        "id",
        "groupId",
        "content"
      ]
    },
    "SavingsSchedule": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SavingsSchedule",
      "type": "object",
      "description": "Represents a savings schedule for the group.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the savings schedule."
        },
        "groupId": {
          "type": "string",
          "description": "Reference to the Group this savings schedule belongs to. (Relationship: Group 1:N SavingsSchedule)"
        },
        "scheduleData": {
          "type": "string",
          "description": "The data representing the savings schedule (e.g., JSON string of the schedule)."
        },
        "generationDate": {
          "type": "string",
          "description": "The date the schedule was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "groupId",
        "scheduleData",
        "generationDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "groups/{groupId}",
        "definition": {
          "entityName": "Group",
          "schema": {
            "$ref": "#/backend/entities/Group"
          },
          "description": "Represents a community group. Top-level entity. Includes group details such as name and currency.",
          "params": [
            {
              "name": "groupId",
              "description": "Unique identifier for the group."
            }
          ]
        }
      },
      {
        "path": "groups/{groupId}/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Represents a user within a group. Includes user details like email and name. This data is denormalized to the user level.",
          "params": [
            {
              "name": "groupId",
              "description": "Unique identifier for the group."
            },
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "groups/{groupId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Represents a financial transaction within a group. Includes transaction details like date, amount, and category.",
          "params": [
            {
              "name": "groupId",
              "description": "Unique identifier for the group."
            },
            {
              "name": "transactionId",
              "description": "Unique identifier for the transaction."
            }
          ]
        }
      },
      {
        "path": "groups/{groupId}/members/{memberId}",
        "definition": {
          "entityName": "Member",
          "schema": {
            "$ref": "#/backend/entities/Member"
          },
          "description": "Represents a member of the community group. Includes member details like name and email.",
          "params": [
            {
              "name": "groupId",
              "description": "Unique identifier for the group."
            },
            {
              "name": "memberId",
              "description": "Unique identifier for the member."
            }
          ]
        }
      },
      {
        "path": "groups/{groupId}/insurancePolicies/{insurancePolicyId}",
        "definition": {
          "entityName": "InsurancePolicy",
          "schema": {
            "$ref": "#/backend/entities/InsurancePolicy"
          },
          "description": "Represents an insurance policy within a group. Includes policy details like name and premium amount.",
          "params": [
            {
              "name": "groupId",
              "description": "Unique identifier for the group."
            },
            {
              "name": "insurancePolicyId",
              "description": "Unique identifier for the insurance policy."
            }
          ]
        },
        "subcollections": {
          "payments": {
            "path": "groups/{groupId}/insurancePolicies/{insurancePolicyId}/payments/{paymentId}",
            "definition": {
              "entityName": "InsurancePayment",
              "schema": {
                "$ref": "#/backend/entities/InsurancePayment"
              },
              "description": "Represents a member's payment towards an insurance policy. Includes payment details like payment date and amount paid.",
              "params": [
                {
                  "name": "groupId",
                  "description": "Unique identifier for the group."
                },
                {
                  "name": "insurancePolicyId",
                  "description": "Unique identifier for the insurance policy."
                },
                {
                  "name": "paymentId",
                  "description": "Unique identifier for the insurance payment."
                }
              ]
            }
          }
        }
      },
      {
        "path": "groups/{groupId}/constitutions/{constitutionId}",
        "definition": {
          "entityName": "Constitution",
          "schema": {
            "$ref": "#/backend/entities/Constitution"
          },
          "description": "Represents the group's constitution document. Includes the text content of the constitution.",
          "params": [
            {
              "name": "groupId",
              "description": "Unique identifier for the group."
            },
            {
              "name": "constitutionId",
              "description": "Unique identifier for the constitution."
            }
          ]
        }
      },
      {
        "path": "groups/{groupId}/savingsSchedules/{savingsScheduleId}",
        "definition": {
          "entityName": "SavingsSchedule",
          "schema": {
            "$ref": "#/backend/entities/SavingsSchedule"
          },
          "description": "Represents a savings schedule for the group. Includes schedule data and generation date.",
          "params": [
            {
              "name": "groupId",
              "description": "Unique identifier for the group."
            },
            {
              "name": "savingsScheduleId",
              "description": "Unique identifier for the savings schedule."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, DBAC, and QAPs. Groups are the root level entity. Each group owns Members, Transactions, InsurancePolicies, InsurancePayments, a Constitution, and a SavingsSchedule.  Authorization independence is achieved by nesting entities within their parent Group.  For instance, access to `Transactions` is controlled at the `groups/{groupId}/transactions/{transactionId}` level, and each transaction inherently belongs to a group. Thus, rules do not need to 'get()' data from other collections. Path-based ownership (`/groups/{groupId}/members/{memberId}`) is employed for `Members` and other entities related to `Groups`. This approach is straightforward for securing user-owned data.  No custom claims are used; authentication relies on `request.auth.uid`. Roles are not explicitly defined but implicitly controlled by access to group-owned documents. QAPs are supported because collections are segregated by group and entity type, ensuring that rules are not filters."
  }
}
